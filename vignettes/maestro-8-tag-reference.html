<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.13">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Maestro Tag Reference</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="maestro-8-tag-reference_files/libs/clipboard/clipboard.min.js"></script>
<script src="maestro-8-tag-reference_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="maestro-8-tag-reference_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="maestro-8-tag-reference_files/libs/quarto-html/popper.min.js"></script>
<script src="maestro-8-tag-reference_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="maestro-8-tag-reference_files/libs/quarto-html/anchor.min.js"></script>
<link href="maestro-8-tag-reference_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="maestro-8-tag-reference_files/libs/quarto-html/quarto-syntax-highlighting-66ab7fd5e73b7f0a764e0d49b3e29ab1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="maestro-8-tag-reference_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="maestro-8-tag-reference_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="maestro-8-tag-reference_files/libs/bootstrap/bootstrap-c0367b04c37547644fece4185067e4a7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#basic-tags" id="toc-basic-tags" class="nav-link active" data-scroll-target="#basic-tags">Basic Tags</a>
  <ul class="collapse">
  <li><a href="#maestrofrequency" id="toc-maestrofrequency" class="nav-link" data-scroll-target="#maestrofrequency">maestroFrequency</a></li>
  <li><a href="#maestrostarttime" id="toc-maestrostarttime" class="nav-link" data-scroll-target="#maestrostarttime">maestroStartTime</a></li>
  <li><a href="#maestrotz" id="toc-maestrotz" class="nav-link" data-scroll-target="#maestrotz">maestroTz</a></li>
  <li><a href="#maestrologlevel" id="toc-maestrologlevel" class="nav-link" data-scroll-target="#maestrologlevel">maestroLogLevel</a></li>
  </ul></li>
  <li><a href="#specifier-tags" id="toc-specifier-tags" class="nav-link" data-scroll-target="#specifier-tags">Specifier Tags</a>
  <ul class="collapse">
  <li><a href="#maestrohours" id="toc-maestrohours" class="nav-link" data-scroll-target="#maestrohours">maestroHours</a></li>
  <li><a href="#maestrodays" id="toc-maestrodays" class="nav-link" data-scroll-target="#maestrodays">maestroDays</a></li>
  <li><a href="#maestromonths" id="toc-maestromonths" class="nav-link" data-scroll-target="#maestromonths">maestroMonths</a></li>
  </ul></li>
  <li><a href="#dag-tags" id="toc-dag-tags" class="nav-link" data-scroll-target="#dag-tags">DAG Tags</a>
  <ul class="collapse">
  <li><a href="#maestroinputs" id="toc-maestroinputs" class="nav-link" data-scroll-target="#maestroinputs">maestroInputs</a></li>
  <li><a href="#maestrooutputs" id="toc-maestrooutputs" class="nav-link" data-scroll-target="#maestrooutputs">maestroOutputs</a></li>
  </ul></li>
  <li><a href="#advanced-tags" id="toc-advanced-tags" class="nav-link" data-scroll-target="#advanced-tags">Advanced Tags</a>
  <ul class="collapse">
  <li><a href="#maestroskip" id="toc-maestroskip" class="nav-link" data-scroll-target="#maestroskip">maestroSkip</a></li>
  <li><a href="#maestropriority" id="toc-maestropriority" class="nav-link" data-scroll-target="#maestropriority">maestroPriority</a></li>
  <li><a href="#maestro" id="toc-maestro" class="nav-link" data-scroll-target="#maestro">maestro</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Maestro Tag Reference</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Maestro Tags</p>
<p>maestro tags are roxygen2 comments for configuring the scheduling and execution of pipelines.</p>
<p>maestro tags follow the format: <code>#' @maestroTagName value</code></p>
<p>Some tags may not take a value.</p>
<p>maestro tags must be written above the function that is to be included as a pipeline. A typical pipeline with tags could look like this:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' @maestroFrequency 1 hour</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' @maestroStartTime 12:30:00</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @maestroLogLevel WARN</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>my_pipeline <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pipeline code</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Below are descriptions of all the tags currently available in maestro along with examples.</p>
<section id="basic-tags" class="level1">
<h1>Basic Tags</h1>
<section id="maestrofrequency" class="level2">
<h2 class="anchored" data-anchor-id="maestrofrequency">maestroFrequency</h2>
<p>How often to run the pipeline. This tag takes a time unit indicating how long to wait between subsequent runs of the pipeline. Acceptable values include an integer value followed by one of minute(s), hour(s), day(s), week(s), month(s), and year(s). Note that some combinations of integer + unit may be invalid. Adverbs like ‘hourly’, ‘daily’, ‘weekly’, etc. are also valid.</p>
<p>Default: <code>1 day</code></p>
<p>Examples:</p>
<ul>
<li><p><code>#' @maestroFrequency 1 hour</code></p></li>
<li><p><code>#' @maestroFrequency daily</code></p></li>
<li><p><code>#' @maestroFrequency 2 weeks</code></p></li>
<li><p><code>#' @maestroFrequency 3 months</code></p></li>
</ul>
</section>
<section id="maestrostarttime" class="level2">
<h2 class="anchored" data-anchor-id="maestrostarttime">maestroStartTime</h2>
<p>Timestamp, date, or time corresponding to the start time of the pipeline. This also sets the cadence of the pipeline in some cases. For instance, if the start time is <code>2025-03-18 03:00:00</code> and the frequency is daily, the pipeline will run at 03:00 every day. A value in the future prevents the pipeline from running until that time has been reached.</p>
<p>Default: <code>2024-01-01 00:00:00</code></p>
<p>Examples:</p>
<ul>
<li><p><code>#' @maestroStartTime 2025-02-05 12:00:00</code></p></li>
<li><p><code>#' @maestroStartTime 2025-01-01</code></p></li>
<li><p><code>#' @maestroStartTime 08:00:00</code></p></li>
</ul>
</section>
<section id="maestrotz" class="level2">
<h2 class="anchored" data-anchor-id="maestrotz">maestroTz</h2>
<p>Timezone in which the maestroStartTime is to be considered. Takes any valid timezone string that can be found in <code>OlsonNames()</code>.</p>
<p>Default: <code>UTC</code></p>
<p>Examples:</p>
<ul>
<li><p><code>#' @maestroTz Europe/Paris</code></p></li>
<li><p><code>#' @maestroTz America/Halifax</code></p></li>
<li><p><code>#' @maestroTz US/Pacific</code></p></li>
</ul>
</section>
<section id="maestrologlevel" class="level2">
<h2 class="anchored" data-anchor-id="maestrologlevel">maestroLogLevel</h2>
<p>Minimum logging threshold for messages, warnings, and errors that come from the pipeline. These levels correspond to those in <code>logger:::log_levels_supported</code> but most commonly used are ERROR, WARN, INFO. For example, if you use <code>WARN</code> then any messages of lower urgency (i.e., INFO) will be suppressed, but errors will be logged.</p>
<p>Default: <code>INFO</code></p>
<p>Examples:</p>
<ul>
<li><p><code>#' @maestroLogLevel ERROR</code></p></li>
<li><p><code>#' @maestroLogLevel WARN</code></p></li>
</ul>
</section>
</section>
<section id="specifier-tags" class="level1">
<h1>Specifier Tags</h1>
<section id="maestrohours" class="level2">
<h2 class="anchored" data-anchor-id="maestrohours">maestroHours</h2>
<p>Specific hours of the day in which to run the pipeline. This only applies for pipelines that run at an hourly or minutely frequency. Acceptable values are integers from 0-23 separated by spaces. If empty, pipeline runs at all hours. This tag uses the timezone specified by <code>maestroTz</code> (will be UTC if empty).</p>
<p>Default:</p>
<p>Examples:</p>
<ul>
<li><p><code>#' @maestroHours 1 4 7 10</code></p></li>
<li><p><code>#' @maestroHours 0 5 20</code></p></li>
</ul>
</section>
<section id="maestrodays" class="level2">
<h2 class="anchored" data-anchor-id="maestrodays">maestroDays</h2>
<p>Specific days of week or days of month on which to run the pipeline. This only applies for pipelines that run at a minutely, hourly, or daily frequency. Acceptable values are either integers from 1-31 or day of week strings like Mon, Tue, Wed, etc. These two options cannot be used in combination.</p>
<p>Default:</p>
<p>Examples:</p>
<ul>
<li><p><code>#' @maestroDays 1 11 21 31</code></p></li>
<li><p><code>#' @maestroDays Mon Tue Wed Thu Fri</code></p></li>
</ul>
</section>
<section id="maestromonths" class="level2">
<h2 class="anchored" data-anchor-id="maestromonths">maestroMonths</h2>
<p>Specific months of the year on which to run the pipeline. This only applies for pipelines that do run at least monthly. Acceptable values are integers (1-12) corresponding to the month of the year (e.g., 1 = January, 2 = February, etc.).</p>
<p>Default:</p>
<p>Examples:</p>
<ul>
<li><p><code>#' @maestroMonths 3 8 12</code></p></li>
<li><p><code>#' @maestroMonths 10</code></p></li>
</ul>
</section>
</section>
<section id="dag-tags" class="level1">
<h1>DAG Tags</h1>
<section id="maestroinputs" class="level2">
<h2 class="anchored" data-anchor-id="maestroinputs">maestroInputs</h2>
<p>For a DAG style pipeline, the names of pipelines that input into the pipeline. These names must match the function name defining the inputting pipeline. Multiple pipelines can be used as inputs and the input value is used in the target pipeline via the required <code>.input</code> parameter. Note that this tag could be redundant if the inputting pipeline uses <code>maestroOutputs</code>.</p>
<p>Default:</p>
<p>Examples:</p>
<ul>
<li><code>#' @maestroInputs extract verify</code></li>
</ul>
</section>
<section id="maestrooutputs" class="level2">
<h2 class="anchored" data-anchor-id="maestrooutputs">maestroOutputs</h2>
<p>For a DAG style pipeline, the names of pipelines that receive the return value of this pipeline as input. These names must match the function name defining the outputting pipeline. Multiple pipelines can be outputted into. The return value of the pipeline will be passed into the receiving pipeline. Note that this tag could be redundant if pipeline to be inputted into uses <code>maestroInputs</code>.</p>
<p>Default:</p>
<p>Examples:</p>
<ul>
<li><code>#' @maestroOutputs transform</code></li>
</ul>
</section>
</section>
<section id="advanced-tags" class="level1">
<h1>Advanced Tags</h1>
<section id="maestroskip" class="level2">
<h2 class="anchored" data-anchor-id="maestroskip">maestroSkip</h2>
<p>Flags a pipeline to never be executed even if it is scheduled to run. This can be useful when developing or testing a pipeline. This tag takes no value, instead the presence of the tag indicates whether it is skipped. This tag is ignored when <code>run_schedule(..., run_all = TRUE)</code> or when using <code>invoke()</code>.</p>
<p>Default:</p>
<p>Examples:</p>
<ul>
<li><code>#' @maestroSkip</code></li>
</ul>
</section>
<section id="maestropriority" class="level2">
<h2 class="anchored" data-anchor-id="maestropriority">maestroPriority</h2>
<p>Determines the order in which pipelines that run at the same scheduled instance are executed. Values are positive integers from 1 to N. Order is determined in descending order such that 1 indicates the highest priority. Pipelines with the same priority run in the order in which <code>build_schedule()</code> parses the pipeline (usually alphabetical according to file name and then line number within file). By default, all pipelines are given equal priority.</p>
<p>Default:</p>
<p>Examples:</p>
<ul>
<li><code>#' @maestroPriority 1</code> - <code>#' @maestroPriority 3</code></li>
</ul>
</section>
<section id="maestro" class="level2">
<h2 class="anchored" data-anchor-id="maestro">maestro</h2>
<p>Generic tag for identifying a maestro pipeline with all the defaults. Useful when you want a pipeline to be scheduled via maestro that accepts all default tag values. Only use this tag if you have no other maestro tags. The tag takes no value.</p>
<p>Default:</p>
<p>Examples:</p>
<ul>
<li><code>#' @maestro</code></li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>